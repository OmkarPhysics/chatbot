{% extends "web/base.html" %}
{% block title %}Reset password{% endblock %}
{% block content %}
  <div class="card p-4 mb-4">
    <h2>Reset password</h2>
    <p class="muted">If you opened a reset link from email, this page can read <code>uidb64</code> and <code>token</code> from the URL query string.</p>
    <div class="mb-3">
      <label class="form-label">uidb64</label>
      <input id="uidb64" type="text" class="form-control" />
    </div>
    <div class="mb-3">
      <label class="form-label">token</label>
      <input id="token" type="text" class="form-control" />
    </div>
    <div class="mb-3">
      <label class="form-label">New password</label>
      <input id="new_password" type="password" class="form-control" />
    </div>
    <div class="d-flex gap-2 mt-3">
      <button type="button" class="btn btn-primary" onclick="doReset()">Reset password</button>
    </div>
    <pre id="out" class="mt-3">{}</pre>
  </div>
{% endblock %}
{% block scripts %}
  <script>
    (function initFromQuery() {
      const params = new URLSearchParams(window.location.search);
      const uidb64 = params.get("uidb64");
      const token = params.get("token");
      if (uidb64) document.getElementById("uidb64").value = uidb64;
      if (token) document.getElementById("token").value = token;
    })();

    async function doReset() {
      const body = {
        uidb64: document.getElementById("uidb64").value,
        token: document.getElementById("token").value,
        new_password: document.getElementById("new_password").value,
      };
      const res = await api("/api/auth/reset-password/", { method: "POST", body });
      show("out", res.json ?? res.text);
    }
  </script>
{% endblock %}

