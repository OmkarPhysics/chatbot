{% extends "web/base.html" %}
{% block title %}Profile{% endblock %}
{% block content %}
  <div class="card p-4 mb-4">
    <h2>Profile (me)</h2>
    <p class="muted">Requires an access token in localStorage (login first).</p>
    <div class="d-flex gap-2 flex-wrap">
      <button type="button" class="btn btn-primary" onclick="doGet()">GET /api/profile/me/</button>
      <button type="button" class="btn btn-outline-secondary" onclick="doPatch()">PATCH name</button>
      <button type="button" class="btn btn-outline-secondary" onclick="doUpload()">PATCH avatar</button>
      <button type="button" class="btn btn-outline-danger" onclick="doDelete()">DELETE account</button>
    </div>
    <div class="mb-3 mt-3">
      <label class="form-label">Name</label>
      <input id="name" type="text" class="form-control" />
    </div>
    <div class="mb-3">
      <label class="form-label">Avatar</label>
      <input id="avatar" type="file" accept="image/*" class="form-control" />
    </div>
    <pre id="out" class="mt-3">{}</pre>
  </div>
{% endblock %}
{% block scripts %}
  <script>
    async function doGet() {
      const res = await api("/api/profile/me/", { method: "GET" });
      show("out", res.json ?? res.text);
      if (res.ok && res.json && res.json.name) document.getElementById("name").value = res.json.name;
    }
    async function doPatch() {
      const name = document.getElementById("name").value;
      const res = await api("/api/profile/me/", { method: "PATCH", body: { name } });
      show("out", res.json ?? res.text);
    }
    async function doUpload() {
      const file = document.getElementById("avatar").files[0];
      const form = new FormData();
      form.append("avatar", file);
      const res = await api("/api/profile/me/", { method: "PATCH", body: form, isForm: true });
      show("out", res.json ?? res.text);
    }
    async function doDelete() {
      const res = await api("/api/profile/me/", { method: "DELETE" });
      if (res.ok) clearTokens();
      show("out", res.json ?? res.text);
    }
  </script>
{% endblock %}

